<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head('Transactions')"></head>
<body>
<div class="app">
  <aside th:replace="fragments/sidebar :: sidebar('transactions')"></aside>
  <main class="content">
    <div class="topbar">
      <div class="title">
        <i class="ri-exchange-dollar-fill" style="color: var(--primary);"></i>
        Transactions
      </div>
      <a class="btn secondary" th:href="@{/dashboard}">
        <i class="ri-arrow-left-line"></i> Back to Dashboard
      </a>
    </div>

    <div class="grid cols-2">
      <!-- Add New Transaction Form -->
      <div class="card">
        <div class="card-title">
          <i class="ri-add-circle-line"></i>
          Add New Transaction
        </div>
        <form class="form" th:action="@{/transactions}" method="post">
          <div class="form-group">
            <label for="date">Date *</label>
            <input type="date" id="date" name="date" required/>
          </div>
          
          <div class="form-group">
            <label for="merchant">Merchant / Description *</label>
            <input type="text" id="merchant" name="merchant" placeholder="e.g., Starbucks, Salary" required/>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="amount">Amount *</label>
              <input type="number" id="amount" step="0.01" name="amount" placeholder="0.00" required/>
            </div>
            
            <div class="form-group">
              <label for="categoryId">Category *</label>
              <select id="categoryId" name="categoryId" required>
                <option value="">Select a category</option>
                <option th:each="c: ${categories}" th:value="${c.id}" th:text="${c.name}">Food</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="accountId">Account *</label>
              <select id="accountId" name="accountId" required>
                <option value="">Select an account</option>
                <option th:each="a: ${accounts}" th:value="${a.id}" th:text="${a.name}">Wallet</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="note">Note (Optional)</label>
              <input type="text" id="note" name="note" placeholder="Additional notes"/>
            </div>
          </div>
          
          <div class="mt-2">
            <button class="btn" type="submit">
              <i class="ri-save-line"></i> Add Transaction
            </button>
          </div>
        </form>
      </div>

      <!-- Transactions List -->
      <div class="card">
        <div class="card-title">
          <i class="ri-list-check"></i>
          All Transactions
        </div>
        
        <div th:if="${transactions != null and !transactions.isEmpty()}">
          <table class="table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Merchant</th>
                <th>Category</th>
                <th>Account</th>
                <th class="right">Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="t: ${transactions}">
                <td th:text="${t.date}">2024-10-01</td>
                <td th:text="${t.merchant}">Merchant</td>
                <td>
                  <span class="badge">
                    <i class="ri-price-tag-3-line"></i>
                    <span th:text="${t.category != null ? t.category.name : 'Uncategorized'}">Food</span>
                  </span>
                </td>
                <td th:text="${t.account.name}">Wallet</td>
                <td class="amount" 
                    th:classappend="${t.category.type.name()=='EXPENSE'} ? 'expense' : 'income'"
                    th:text="'$' + ${#numbers.formatDecimal(t.amount,1,'COMMA',2,'POINT')}">$0.00</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div th:if="${transactions == null or transactions.isEmpty()}" 
             class="text-center" style="padding: 3rem;">
          <i class="ri-exchange-dollar-line" style="font-size: 4rem; color: var(--text-muted);"></i>
          <p class="text-muted mt-1">No transactions yet</p>
          <p class="text-muted">Add your first transaction using the form</p>
        </div>
      </div>
    </div>

    <!-- Summary Cards -->
    <div class="grid cols-3 mt-3">
      <div class="card">
        <div class="card-title">
          <i class="ri-bar-chart-box-line"></i>
          Quick Stats
        </div>
        <div class="stats-row">
          <span class="stats-label">Total Transactions:</span>
          <span class="stats-value" th:text="${transactions != null ? transactions.size() : 0}">0</span>
        </div>
        <div class="stats-row">
          <span class="stats-label">Categories Used:</span>
          <span class="stats-value" th:text="${categories != null ? categories.size() : 0}">0</span>
        </div>
        <div class="stats-row">
          <span class="stats-label">Accounts:</span>
          <span class="stats-value" th:text="${accounts != null ? accounts.size() : 0}">0</span>
        </div>
      </div>
    </div>

  </main>
</div>
<div th:replace="fragments/scripts :: scripts"></div>
</body>
</html>
